# ---------------------------------------------------------------------
# Monorepo example (advanced / experimental)
#
# This file demonstrates a realistic monorepo configuration using rig.
# For clarity, shared `.rig/` fragments are inlined here.
#
# In real monorepos, shared tasks and tools would normally live under
# `.rig/` and be referenced via `include`.
# ---------------------------------------------------------------------

[project]
name = "init-dx-monorepo"
version = "0.1.0"
license = "MIT"

# ---------------------------------------------------------------------
# Build profiles
#
# Profiles describe build intent for different environments.
# They do not introduce logic.
# ---------------------------------------------------------------------

[profile.dev]
flags = ["-race"]

[profile.release]
ldflags = "-s -w"
output = "bin/app"

# ---------------------------------------------------------------------
# Tasks (originally .rig/rig.tasks.toml)
#
# These tasks are shared across packages in the monorepo.
# ---------------------------------------------------------------------

[tasks]

# Build and verification
build = "go build ./..."
test  = "go test ./..."
vet   = "go vet ./..."
fmt   = "gofmt -s -w ."

# Local execution (single entrypoint example)
run = "go run ."

# Linting using an external tool (experimental)
lint = "golangci-lint run ./..."

# Development workflow using file watching (experimental)
#
# This task demonstrates how external tools can be orchestrated via rig.
# File watching and shell pipelines are not yet stabilized.
dev = "reflex -r \"\\.go$\" -- sh -c 'go run .'"

# ---------------------------------------------------------------------
# Tools (originally .rig/rig.tools.toml)
#
# Tool pinning surface for development and CI parity.
# Lockfile semantics may evolve as rig stabilizes.
# ---------------------------------------------------------------------

[tools]
# Pin Go toolchain for reproducible development / CI
go = "1.21.5"

# Developer tooling
golangci-lint = "1.62.0"
github.com/cespare/reflex = "latest"
